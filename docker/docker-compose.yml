version: '2'

# Network.
networks:
  prodnetwork:
    driver: bridge

# Services.
services:
  # Application
  centos_setup_application:
    build: ./containers/application
    restart: always
    # command: bash /var/application/bootstrap.sh
    networks:
      - prodnetwork
    # links:
    #   - centos_setup_mail:centos_setup_mail
    environment:
      container: docker
    # ports:
    #   # Apache.
    #   - "280:80"
    # expose:
    #   - "80"
    depends_on:
      - centos_setup_mail
    volumes:
      - ./containers/application:/var/application
      - ./containers/application/html:/var/www/html
    container_name: centos_setup_application
  # Application
  centos_setup_web_server:
    build: ./containers/web_server
    restart: always
    # command: bash /var/web_server/bootstrap.sh
    networks:
      - prodnetwork
    environment:
      container: docker
    ports:
      # Apache.
      - "280:80"
      - "28080:8080"
    expose:
      - "80"
      - "8080"
    depends_on:
      - centos_setup_mail
      - centos_setup_application
    volumes:
      - ./containers/web_server:/var/web_server
      - ./containers/application/html:/var/www/html
    container_name: centos_setup_web_server
  # Search
  centos_setup_search:
    build: ./containers/search
    restart: always
    # command: bash /var/search/bootstrap.sh
    networks:
      - prodnetwork
    environment:
      container: docker
    ports:
      # SOLR.
      - "18983:8983"
    expose:
      - "8983"
    #depends_on:
    volumes:
      - ./containers/search:/var/search
      - ./containers/application/html:/var/www/html
    container_name: centos_setup_search
  # Cache
  centos_setup_cache:
    build: ./containers/cache
    restart: always
    # command: bash /var/cache/bootstrap.sh
    networks:
      - prodnetwork
    environment:
      container: docker
    ports:
      # Varnish.
      - "180:80"
      # Memcached.
      - "11211:11211"
    expose:
      - "80"
      - "11211"
    #depends_on:
    volumes:
      - ./containers/cache:/var/cache
      - ./containers/application/html:/var/www/html
    container_name: centos_setup_cache
  # Database
  centos_setup_database:
    build: ./containers/database
    restart: always
    # command: bash /var/database/bootstrap.sh
    networks:
      - prodnetwork
    environment:
      MYSQL_USER: root
      MYSQL_PASSWORD: root
      MYSQL_DATABASE: root
      container: docker
    ports:
      # MySQL.
      - "13306:3306"
    expose:
      - "3306"
    #depends_on:
    volumes:
      -  /var/lib/mysql
      - ./containers/database:/var/database
      - ./containers/application/html:/var/www/html
    container_name: centos_setup_database
  # Mail
  centos_setup_mail:
    build: ./containers/mail
    restart: always
    # command: bash /var/mail/bootstrap.sh
    #ports:
    networks:
      - prodnetwork
    environment:
      container: docker
    ports:
      - "225:25"
    expose:
      - "25"
    #depends_on:
    volumes:
      - ./containers/mail:/var/mail
      - ./containers/application/html:/var/www/html
    container_name: centos_setup_mail
